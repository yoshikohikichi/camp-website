<script>
    let answerNumber;
    let attempts;
    const bgm = document.getElementById('bgm');

    function initializeGame() {
        answerNumber = Math.floor(Math.random() * 100) + 1;
        console.log('正解は' + answerNumber);
        attempts = 5;

        document.querySelector('#guessResult').textContent = '';
        document.querySelector('#attemptsLeft').textContent = '残り回数: ' + attempts;
        document.querySelector('#guessField').value = '';
        document.querySelector('#guessField').disabled = false;
        document.querySelector('#guessSubmit').disabled = false;

        // BGMを最初から再生
        bgm.currentTime = 0;
        bgm.play();
    }

    function checkGuess() {
        if (attempts <= 0) return;
        
        let userGuess = Number(document.querySelector('#guessField').value);
        let guessResult = document.querySelector('#guessResult');
        attempts--;

        if (userGuess === answerNumber) { 
            guessResult.textContent = '正解です！';
            document.querySelector('#guessSubmit').disabled = true;
            document.querySelector('#guessField').disabled = true;
            bgm.pause(); // 正解したらBGMを停止
        } else {
            guessResult.textContent = userGuess < answerNumber ? 'もっと大きいです' : 'もっと小さいです';
            if (attempts === 0) {
                guessResult.textContent += ' ゲームオーバー！正解は ' + answerNumber + ' でした。';
                document.querySelector('#guessSubmit').disabled = true;
                document.querySelector('#guessField').disabled = true;
                bgm.pause(); // ゲームオーバーでもBGMを停止
            }
        }

        document.querySelector('#attemptsLeft').textContent = '残り回数: ' + attempts;
        bgm.play(); // ユーザー操作時に再生（停止してしまう場合の対策）
    }

    document.querySelector('#guessSubmit').addEventListener('click', checkGuess);
    document.querySelector('#resetGame').addEventListener('click', initializeGame);

    initializeGame();
</script>
